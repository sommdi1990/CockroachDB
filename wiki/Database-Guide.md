# راهنمای کامل دیتابیس سیستم مدیریت دانشگاه

## مقدمه

این راهنما شامل تمام اطلاعات لازم برای کار با دیتابیس سیستم مدیریت دانشگاه است که بر روی CockroachDB پیاده‌سازی شده است.

## ساختار دیتابیس

### جداول اصلی

#### 1. جدول دانشکده‌ها (departments)
این جدول شامل اطلاعات دانشکده‌های دانشگاه است:

- `department_id`: شناسه یکتا دانشکده
- `department_name`: نام دانشکده
- `department_code`: کد دانشکده
- `dean_name`: نام رئیس دانشکده
- `dean_email`: ایمیل رئیس دانشکده
- `dean_phone`: تلفن رئیس دانشکده
- `building_name`: نام ساختمان
- `floor_number`: شماره طبقه

#### 2. جدول رشته‌های تحصیلی (majors)
این جدول شامل اطلاعات رشته‌های تحصیلی است:

- `major_id`: شناسه یکتا رشته
- `major_name`: نام رشته
- `major_code`: کد رشته
- `department_id`: شناسه دانشکده
- `degree_level`: سطح تحصیلی (Bachelor, Master, PhD)
- `credits_required`: تعداد واحدهای مورد نیاز
- `duration_years`: مدت زمان تحصیل
- `description`: توضیحات رشته

#### 3. جدول دانشجویان (students)
این جدول شامل اطلاعات دانشجویان است:

- `student_id`: شناسه یکتا دانشجو
- `student_number`: شماره دانشجویی
- `first_name`: نام
- `last_name`: نام خانوادگی
- `national_id`: کد ملی
- `email`: ایمیل
- `phone`: تلفن
- `address`: آدرس
- `date_of_birth`: تاریخ تولد
- `gender`: جنسیت
- `enrollment_date`: تاریخ ثبت‌نام
- `graduation_date`: تاریخ فارغ‌التحصیلی
- `status`: وضعیت (Active, Graduated, Suspended, Dropped)
- `major_id`: شناسه رشته
- `gpa`: معدل

#### 4. جدول اساتید (professors)
این جدول شامل اطلاعات اساتید است:

- `professor_id`: شناسه یکتا استاد
- `employee_number`: شماره پرسنلی
- `first_name`: نام
- `last_name`: نام خانوادگی
- `national_id`: کد ملی
- `email`: ایمیل
- `phone`: تلفن
- `address`: آدرس
- `date_of_birth`: تاریخ تولد
- `gender`: جنسیت
- `hire_date`: تاریخ استخدام
- `salary`: حقوق
- `rank`: رتبه علمی
- `specialization`: تخصص
- `department_id`: شناسه دانشکده
- `status`: وضعیت

#### 5. جدول دروس (courses)
این جدول شامل اطلاعات دروس است:

- `course_id`: شناسه یکتا درس
- `course_code`: کد درس
- `course_name`: نام درس
- `course_description`: توضیحات درس
- `credits`: تعداد واحد
- `department_id`: شناسه دانشکده
- `professor_id`: شناسه استاد
- `prerequisites`: پیش‌نیازها
- `course_type`: نوع درس (Core, Elective, General)
- `semester`: ترم (Fall, Spring, Summer)
- `academic_year`: سال تحصیلی
- `max_students`: حداکثر تعداد دانشجو
- `current_students`: تعداد فعلی دانشجویان
- `status`: وضعیت

#### 6. جدول ثبت‌نام‌ها (enrollments)
این جدول شامل اطلاعات ثبت‌نام دانشجویان در دروس است:

- `enrollment_id`: شناسه یکتا ثبت‌نام
- `student_id`: شناسه دانشجو
- `course_id`: شناسه درس
- `enrollment_date`: تاریخ ثبت‌نام
- `semester`: ترم
- `academic_year`: سال تحصیلی
- `status`: وضعیت (Enrolled, Completed, Dropped, Failed)
- `final_grade`: نمره نهایی

#### 7. جدول نمرات (grades)
این جدول شامل اطلاعات نمرات است:

- `grade_id`: شناسه یکتا نمره
- `enrollment_id`: شناسه ثبت‌نام
- `assignment_type`: نوع تکلیف (Quiz, Midterm, Final, Project, Homework)
- `assignment_name`: نام تکلیف
- `points_earned`: نمره کسب شده
- `points_possible`: نمره کل
- `percentage`: درصد (محاسبه شده)
- `grade_letter`: نمره حرفی
- `comments`: نظرات
- `graded_by`: تصحیح کننده
- `graded_date`: تاریخ تصحیح

#### 8. جدول کلاس‌ها (classrooms)
این جدول شامل اطلاعات کلاس‌ها و سالن‌ها است:

- `classroom_id`: شناسه یکتا کلاس
- `room_number`: شماره اتاق
- `building_name`: نام ساختمان
- `capacity`: ظرفیت
- `room_type`: نوع اتاق (Lecture Hall, Laboratory, Seminar Room, Computer Lab)
- `equipment`: تجهیزات
- `floor_number`: شماره طبقه
- `is_accessible`: دسترسی برای معلولان
- `status`: وضعیت

#### 9. جدول برنامه‌ها (schedules)
این جدول شامل اطلاعات برنامه‌ریزی کلاس‌ها است:

- `schedule_id`: شناسه یکتا برنامه
- `course_id`: شناسه درس
- `classroom_id`: شناسه کلاس
- `professor_id`: شناسه استاد
- `day_of_week`: روز هفته
- `start_time`: ساعت شروع
- `end_time`: ساعت پایان
- `semester`: ترم
- `academic_year`: سال تحصیلی
- `status`: وضعیت

#### 10. جدول سال‌های تحصیلی (academic_years)
این جدول شامل اطلاعات سال‌های تحصیلی است:

- `academic_year_id`: شناسه یکتا سال تحصیلی
- `year_name`: نام سال تحصیلی
- `start_date`: تاریخ شروع
- `end_date`: تاریخ پایان
- `fall_semester_start`: شروع ترم پاییز
- `fall_semester_end`: پایان ترم پاییز
- `spring_semester_start`: شروع ترم بهار
- `spring_semester_end`: پایان ترم بهار
- `summer_semester_start`: شروع ترم تابستان
- `summer_semester_end`: پایان ترم تابستان
- `is_current`: سال جاری
- `status`: وضعیت

#### 11. جدول سوابق مالی (financial_records)
این جدول شامل اطلاعات مالی دانشجویان است:

- `record_id`: شناسه یکتا سابقه
- `student_id`: شناسه دانشجو
- `transaction_type`: نوع تراکنش (Tuition, Fee, Scholarship, Refund, Penalty)
- `amount`: مبلغ
- `description`: توضیحات
- `transaction_date`: تاریخ تراکنش
- `due_date`: تاریخ سررسید
- `payment_date`: تاریخ پرداخت
- `payment_method`: روش پرداخت
- `status`: وضعیت

#### 12. جدول اعلان‌ها (notifications)
این جدول شامل اطلاعات اعلان‌ها است:

- `notification_id`: شناسه یکتا اعلان
- `recipient_id`: شناسه گیرنده
- `recipient_type`: نوع گیرنده (Student, Professor, Admin)
- `title`: عنوان
- `message`: پیام
- `notification_type`: نوع اعلان
- `is_read`: خوانده شده
- `priority`: اولویت
- `created_at`: تاریخ ایجاد
- `read_at`: تاریخ خواندن
- `expires_at`: تاریخ انقضا

#### 13. جدول حساب‌های کاربری (user_accounts)
این جدول شامل اطلاعات حساب‌های کاربری است:

- `account_id`: شناسه یکتا حساب
- `user_id`: شناسه کاربر
- `user_type`: نوع کاربر (Student, Professor, Admin)
- `username`: نام کاربری
- `password_hash`: هش رمز عبور
- `email`: ایمیل
- `is_active`: فعال
- `last_login`: آخرین ورود
- `login_attempts`: تعداد تلاش ورود
- `locked_until`: قفل شده تا
- `created_at`: تاریخ ایجاد
- `updated_at`: تاریخ به‌روزرسانی

#### 14. جدول لاگ تغییرات (audit_log)
این جدول شامل اطلاعات لاگ تغییرات است:

- `log_id`: شناسه یکتا لاگ
- `table_name`: نام جدول
- `record_id`: شناسه رکورد
- `action`: عمل (INSERT, UPDATE, DELETE)
- `old_values`: مقادیر قدیمی
- `new_values`: مقادیر جدید
- `changed_by`: تغییر دهنده
- `changed_at`: تاریخ تغییر
- `ip_address`: آدرس IP
- `user_agent`: User Agent

## روابط بین جداول

### روابط اصلی:
1. **دانشکده ← رشته**: هر دانشکده می‌تواند چندین رشته داشته باشد
2. **رشته ← دانشجو**: هر رشته می‌تواند چندین دانشجو داشته باشد
3. **دانشکده ← استاد**: هر دانشکده می‌تواند چندین استاد داشته باشد
4. **دانشکده ← درس**: هر دانشکده می‌تواند چندین درس داشته باشد
5. **استاد ← درس**: هر استاد می‌تواند چندین درس داشته باشد
6. **دانشجو ← ثبت‌نام**: هر دانشجو می‌تواند در چندین درس ثبت‌نام کند
7. **درس ← ثبت‌نام**: هر درس می‌تواند چندین دانشجو داشته باشد
8. **ثبت‌نام ← نمره**: هر ثبت‌نام می‌تواند چندین نمره داشته باشد
9. **درس ← برنامه**: هر درس می‌تواند چندین برنامه داشته باشد
10. **کلاس ← برنامه**: هر کلاس می‌تواند چندین برنامه داشته باشد
11. **استاد ← برنامه**: هر استاد می‌تواند چندین برنامه داشته باشد

## ایندکس‌ها

### ایندکس‌های اصلی:
- ایندکس بر روی کدهای یکتا (student_number, employee_number, course_code)
- ایندکس بر روی ایمیل‌ها
- ایندکس بر روی شناسه‌های خارجی
- ایندکس بر روی وضعیت‌ها
- ایندکس بر روی تاریخ‌ها

### ایندکس‌های ترکیبی:
- ایندکس برای جستجوی دانشجویان بر اساس رشته و وضعیت
- ایندکس برای جستجوی دروس بر اساس دانشکده و ترم
- ایندکس برای جستجوی ثبت‌نام‌ها بر اساس دانشجو و ترم
- ایندکس برای جستجوی برنامه‌ها بر اساس استاد و روز

## ویوها

### ویوهای اصلی:
1. **student_details**: اطلاعات کامل دانشجویان
2. **professor_details**: اطلاعات کامل اساتید
3. **course_details**: اطلاعات کامل دروس
4. **enrollment_details**: اطلاعات کامل ثبت‌نام‌ها
5. **grade_summary**: خلاصه نمرات
6. **student_gpa**: محاسبه GPA دانشجویان
7. **schedule_details**: اطلاعات کامل برنامه‌ها
8. **financial_summary**: خلاصه وضعیت مالی
9. **department_statistics**: آمار دانشکده‌ها
10. **notification_summary**: خلاصه اعلان‌ها

## محدودیت‌ها و قوانین

### محدودیت‌های داده:
- شماره دانشجویی باید یکتا باشد
- شماره پرسنلی باید یکتا باشد
- کد ملی باید یکتا باشد
- ایمیل باید یکتا باشد
- GPA باید بین 0 و 4 باشد
- نمرات باید بین 0 و 100 باشد

### قوانین کسب و کار:
- دانشجو نمی‌تواند در همان درس دو بار ثبت‌نام کند
- استاد نمی‌تواند در همان زمان در دو کلاس باشد
- کلاس نمی‌تواند بیش از ظرفیت خود دانشجو داشته باشد
- دانشجو نمی‌تواند در دروسی ثبت‌نام کند که پیش‌نیازهایش را نگذرانده

## امنیت

### سطوح دسترسی:
- **دانشجو**: دسترسی به اطلاعات شخصی و نمرات
- **استاد**: دسترسی به اطلاعات دروس و دانشجویان
- **مدیر**: دسترسی کامل به سیستم

### رمزگذاری:
- رمزهای عبور با الگوریتم bcrypt رمزگذاری می‌شوند
- اطلاعات حساس در لاگ تغییرات ثبت می‌شوند

## بهینه‌سازی

### بهینه‌سازی پرس و جو:
- استفاده از ایندکس‌های مناسب
- استفاده از ویوها برای پرس و جوهای پیچیده
- استفاده از محدودیت‌ها برای جلوگیری از داده‌های نامعتبر

### بهینه‌سازی ذخیره‌سازی:
- استفاده از انواع داده مناسب
- استفاده از فشرده‌سازی برای داده‌های بزرگ
- استفاده از پارتیشن‌بندی برای جداول بزرگ

## پشتیبان‌گیری

### انواع پشتیبان‌گیری:
- **پشتیبان‌گیری کامل**: شامل تمام داده‌ها و ساختار
- **پشتیبان‌گیری ساختاری**: فقط شامل ساختار جداول
- **پشتیبان‌گیری داده‌ای**: فقط شامل داده‌ها

### زمان‌بندی پشتیبان‌گیری:
- پشتیبان‌گیری روزانه در ساعت 2 صبح
- نگهداری پشتیبان‌ها به مدت 30 روز
- پشتیبان‌گیری قبل از تغییرات مهم

## مانیتورینگ

### معیارهای مانیتورینگ:
- تعداد اتصالات فعال
- استفاده از CPU و حافظه
- تعداد پرس و جوها در ثانیه
- زمان پاسخ پرس و جوها
- اندازه دیتابیس

### هشدارها:
- هشدار در صورت قطع اتصال
- هشدار در صورت استفاده بیش از حد از منابع
- هشدار در صورت خطاهای پرس و جو

## عیب‌یابی

### مشکلات رایج:
- مشکل اتصال به دیتابیس
- مشکل در اجرای پرس و جوها
- مشکل در عملکرد سیستم

### راه‌حل‌ها:
- بررسی وضعیت سرویس CockroachDB
- بررسی لاگ‌های سیستم
- بررسی استفاده از منابع
- بررسی ایندکس‌ها و بهینه‌سازی پرس و جوها
